var $=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var st=Object.prototype.hasOwnProperty;var it=(t,e)=>{for(var n in e)$(t,n,{get:e[n],enumerable:!0})},ot=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of rt(e))!st.call(t,l)&&l!==n&&$(t,l,{get:()=>e[l],enumerable:!(o=nt(e,l))||o.enumerable});return t};var ft=t=>ot($({},"__esModule",{value:!0}),t);var gt={};it(gt,{encode:()=>tt});module.exports=ft(gt);var Ie=new Uint8Array([0,0,74,83,79,78,88,76]),xe=9,Te=255,pe=65535,Ee=16777215,ee=134217727,te=268435455,Ae=1073741823;var z=4294967295,ue=-127,be=127,de=-32767,ge=32767,we=-8388607,Ue=8388607,ke=-2147483647,Re=2147483647,ye=127,Me=16383,Oe=2097151,L=0,Ce=1,G=2,U=4,P=8,d=16,ne=32,re=64,S=128,u=0,w=1,m=2,F=3,q=4,K=5,Q=6;var D=8,V=9,B=10,j=11,X=12,Le=31,H=224,Se=7936,k=0,g=1,R=2,y=3,M=4,O=5,W=6,J=7,se=8,Ye=0,ie=16,Pe=32,De=~d,Ut=G|ne|re,C=new Uint8Array(256).map((t,e)=>{for(let n=0;n<8;n++)t+=e>>n&1;return t});var Ge=65536,fe=new Uint32Array(16),oe=fe.subarray(0,8),Ve=fe.subarray(8,16);function ce(t){return Math.fround(t)===t?K:Q}function le(t){return t<0?t<de?t<we?t<ke?X:j:B:t<ue?V:D:t>ge?t>Ue?t>Re?X:j:B:t>be?V:D}function me(t){return t>pe?t>Ee?t>z?q:F:m:t>Te?w:u}function _e(t){return Number.isInteger(t)?t<0?le(t):me(t):ce(t)}function ct(t){return Number.isInteger(t)?le(t):ce(t)}function Be(t,e){let n=Math.max(Math.abs(t),Math.abs(e)),o=t<0?1:0;return Math.max(32-Math.clz32(n)+o,1)}function lt(t,e,n,o){switch(o){case u:e[k]+=1,e[R]+=n>127?2:1,e[M]+=n>7?1:0;break;case w:e[k]+=2,e[R]+=n>16383?3:2,e[M]+=n>1023?2:1;break;case m:e[k]+=3,e[R]+=n>2097151?4:3,e[M]+=n>131071?3:2;break;case F:e[k]+=4,e[R]+=n>268435455?5:4,e[M]+=n>16777215?4:3;break;case q:{let l=t.vlqBytesNeeded(n);e[k]+=l,e[R]+=l,e[M]+=t.vlqBytesNeeded((n-(n&7))/8);break}}}function _t(t,e,n,o){switch(n<0&&(n=-n),o){case D:{e[g]+=1,e[y]+=n>63?2:1,e[O]+=n>3?1:0;break}case V:{e[g]+=2,e[y]+=n>8191?3:2,e[O]+=n>511?2:1;break}case B:{e[g]+=3,e[y]+=n>1048575?4:3,e[O]+=n>65535?3:2;break}case j:{e[g]+=4,e[y]+=n>134217727?5:4,e[O]+=n>8388607?4:3;break}case X:{let l=2*n,r=t.vlqBytesNeeded(l);e[g]+=r,e[y]+=r,e[O]+=t.vlqBytesNeeded((l-(l&7))/8);break}}}function je(t,e,n){let o=le(n);if(_t(t,e,n,o),n>=0){let l=me(n);return lt(t,e,n,l),1<<o|1<<l}return 1<<o|Ge}function Fe(t,e,n,o){let l=n&Ge,r=l?g:k,f=l?(n>>8|n&H)&255:n&(Le|H),s=C[f],i=e[r]+(s>1?Math.ceil(t*(s<=2?1:s<=4?2:3)/8):0)+(o?2:0);return{encoding:f<<8|r,minBytes:i}}function Xe(t,e,n,o,l,r){let f=r<=16?Math.ceil(t*r/8)+(o?2:0):1/0,{encoding:s,minBytes:i}=Fe(t,e,n,o);if((s&15)===g){let _=e[y]+(o?1:0),h=e[O]+Math.ceil(t/2)+(o?1:0);f<i&&(s=r<<8|J,i=f),_<i&&(s=y,i=_),h<i&&(s=O,i=h)}else{let _=e[R]+(o?1:0),h=e[M]+Math.ceil(t/2)+(o?1:0);f<i&&(s=r<<8|W,i=f),_<i&&(s=R,i=_),h<i&&(s=M,i=h)}return{encoding:s|l,minBytes:i}}function at(t,e,n=!0,o=0,l=e.length){let r=l-o,f=0,s=!1,i=e[o],c=e[o];fe.fill(0);for(let T=o;T<l;T++){let E=e[T];Number.isInteger(E)?f|=je(t,oe,E):(f|=1<<ce(E),s=!0),E<i&&(i=E),E>c&&(c=E)}if(s||r<2)return Fe(r,oe,f,n);let _=e[o+1]-e[o],h=_,a=_,x=0;for(let T=o;T<l;T++){let E=e[T];if(T!==o){let Y=E-e[T-1];x|=je(t,Ve,Y),_!==Y&&(_=!1),Y>h&&(h=Y),Y<a&&(a=Y)}}let{encoding:I,minBytes:p}=Xe(r,oe,f,n,Ye,Be(i,c)),A=Xe(r-1,Ve,x,n,ie,Be(a,h)),N=A.minBytes+t.intVarBytesNeeded(e[o]);if(N<p&&(I=A.encoding,p=N),r>2&&_!==!1){let T=t.intVarBytesNeeded(e[o])+t.intVarBytesNeeded(_)+(n?1:0);T<p&&(I=se,p=T)}return{encoding:I,minBytes:p}}function ae(t,e,n=!0){let{encoding:o}=at(t,e,n);return o}function ht(t,e){switch(e&15){case k:case g:case W:case J:t.writeNumber(e,w);break;default:t.writeNumber(e,u)}}function b(t,e,n){if(n||t.writeVlq(e.length),e.length>0){let o=ae(t,e,!0);ht(t,o),he(t,e,o)}}function he(t,e,n){let o=n&15,l=n&48,r=e;switch(l){case ie:{t.writeIntVar(r[0]),r=Array.from({length:e.length-1},(f,s)=>e[s+1]-e[s]);break}case Pe:{let f=r[0];for(let s=1;s<r.length;s++)r[s]<f&&(f=r[s]);t.writeIntVar(f),r=Array.from(e,s=>s-f);break}}switch(o){case R:{for(let f=0;f<r.length;f++)t.writeVlq(r[f]);break}case y:{for(let f=0;f<r.length;f++)t.writeIntVar(r[f]);break}case M:{for(let f=0;f<r.length;f+=2)t.writeNumber((r[f]>7?8:0)|r[f]&7|(r[f+1]>7?128:0)|(r[f+1]&7)<<4,u);for(let f=0;f<r.length;f++)r[f]>7&&t.writeVlq((r[f]-(r[f]&7))/8);break}case O:{for(let f=0;f<r.length;f+=2){let s=r[f],i=Math.abs(s),c=r[f+1]||0,_=Math.abs(c);t.writeNumber((i>3?8:0)|i&3|(s<0?4:0)|(_>3?128:0)|(_&3|(c<0?4:0))<<4,u)}for(let f=0;f<r.length;f++){let s=r[f]>=0?r[f]:-r[f];s>3&&t.writeVlq((s-(s&3))/4)}break}case W:{let f=n>>8,s=0,i=0;for(let c=0;c<r.length;c++)i|=r[c]<<s,s+=f,s>=16&&(t.writeNumber(i,w),s-=16,i>>=16);s>8?t.writeNumber(i,w):s>0&&t.writeNumber(i,u);break}case J:{let f=n>>8,s=0,i=0;for(let c=0;c<r.length;c++){let _=r[c];i|=(_<0?-_<<1|1:_<<1)<<s,s+=f,s>=16&&(t.writeNumber(i,w),s-=16,i>>=16)}s>8?t.writeNumber(i,w):s>0&&t.writeNumber(i,u);break}case se:{t.writeIntVar(r[0]),t.writeIntVar(r[1]-r[0]);break}case k:case g:{let f=o===g,s=n>>8,i=f?n&Se|s&H:s;if(C[s]>1){let _=f?r.map(ct):r.map(_e);t.writeTypeIndex(_,i,!1);for(let h=0;h<r.length;h++)t.writeNumber(r[h],_[h])}else{let _=31-Math.clz32(i);for(let h=0;h<r.length;h++)t.writeNumber(r[h],_)}break}default:throw new Error("Unknown numeric array encoding method:",o)}}function Nt(t,e){let n=Math.min(t.length,e.length);if(n>=3){let o=0;for(;o<n&&t[o]===e[o];o++);if(o>=3)return o}return 0}function It(t,e,n){let o=Math.min(t.length,e.length-n);if(o>=3){let l=0;for(;l<o&&t[t.length-1-l]===e[e.length-1-l];l++);if(l>=3)return-l}return 0}function qe(t,e,n,o,l,r,f,s,i){let c="",_="";n.sort((h,a)=>o[h]<o[a]?-1:1);for(let h=0;h<n.length;h++){let a=i++,x=n[h],I=o[x],p=Nt(_,I),A=It(_,I,p)||I.length,N=p>0,T=A<0,E=N||T?I.slice(p,A):I;s[x]=a,l[a]=E.length<<2|N<<1|T<<0,_=I,c.length+E.length>e?(c!==""&&t.push(c),c=E):c+=E,N&&r.push(p),T&&f.push(-A)}c!==""&&t.push(c)}function ve(t,e,n=16*1024*1024){let o=new Uint32Array(t.length),l=[],r=[],f=new Uint32Array(t.length),s=new Uint32Array(t.length),i=new Set,c=[],_=0;for(let a=0;a<e.length;a++){let x=e[a];++f[x]===2&&i.add(x)}let h=new Uint32Array(i).sort((a,x)=>f[x]-f[a]);for(let a of[[0,127],[127,16383]])if(h.length>_){let x=h.subarray(a[0],a[1]);qe(c,n,x,t,o,l,r,s,_),_+=x.length;for(let I=0;I<x.length;I++)f[x[I]]=0}for(let a=0,x=0;a<f.length;a++)f[a]!==0&&(f[x++]=a);qe(c,n,f.subarray(0,f.length-_),t,o,l,r,s,_);for(let a=0;a<e.length;a++)e[a]=s[e[a]];return{strings:c,stringDefs:o,stringSlicesStart:l,stringSlicesEnd:r,stringRefs:e}}var xt=new TextEncoder;function ze(t=65536){let e=()=>{r=[],n()},n=()=>{f=new Uint8Array(t),s=new DataView(f.buffer),i=0},o=()=>{r.push(f.subarray(0,i)),f=s=null},l=c=>{i+c>f.length&&(o(),n())},r=null,f=null,s=null,i=0;if(t<8)throw new Error("Chunk size can't be less than 8 bytes");return e(),{ensureCapacity:l,reset:e,emit(){if(r===null)return[];o();let c=r;return r=null,c},get written(){return r!==null?r.reduce((c,_)=>c+_.byteLength,0)+i:0},writeBytes(c){let _=0;for(;_<c.byteLength;){let h=f.byteLength-i,a=c.subarray(_,_+=h);f.set(a,i),i+=a.byteLength,_<c.byteLength&&(o(),n())}},writeString(c){let _=0;for(;_<c.length;){let{read:h,written:a}=xt.encodeInto(_>0?c.slice(_):c,i>0?f.subarray(i):f);_+=h,i+=a,_<c.length&&(o(),n())}},writeUint8(c){l(1),s.setUint8(i,c),i+=1},writeInt8(c){l(1),s.setInt8(i,c),i+=1},writeUint16(c){l(2),s.setUint16(i,c,!0),i+=2},writeInt16(c){l(2),s.setInt16(i,c,!0),i+=2},writeUint24(c){l(3),s.setUint16(i,c,!0),s.setUint8(i+2,c>>16),i+=3},writeInt24(c){l(3),s.setInt16(i,c,!0),s.setInt8(i+2,c>>16),i+=3},writeUint32(c){l(4),s.setUint32(i,c,!0),i+=4},writeInt32(c){l(4),s.setInt32(i,c,!0),i+=4},writeUint64(c){l(8),s.setBigUint64(i,BigInt(c),!0),i+=8},writeFloat32(c){l(4),s.setFloat32(i,c,!0),i+=4},writeFloat64(c){l(8),s.setFloat64(i,c,!0),i+=8}}}var Tt=Math.floor(Number.MAX_SAFE_INTEGER/2),Qe=new Uint8Array(33);for(let t=0;t<33;t++)Qe[32-t]=Math.ceil(t/7)||1;function Ke(t,e){let n=new Uint32Array(e.length),o=new Uint32Array(e.length).map((r,f)=>f),l=e.slice();for(let r=0;r<t.length;r++)n[t[r]]++;o.sort((r,f)=>n[f]-n[r]||r-f);for(let r=0;r<o.length;r++)n[o[r]]=r,e[r]=l[o[r]];for(let r=0;r<t.length;r++)t[r]=n[t[r]]}function pt(t){let e=t.reduce((l,r)=>l+r.byteLength,0),n=new Uint8Array(e),o=0;for(let l of t)n.set(l,o),o+=l.byteLength;return n}var Z=class{constructor(e){this.backend=ze(e),this.objectKeys=new Map,this.objectEntryDefs=[],this.arrayLengths=[],this.arrayHeaders=new Map,this.arrayHeaderRefs=[],this.strings=new Map,this.stringRefs=[]}emit(){let e=new Uint8Array(12),n=new DataView(e.buffer);e.set(Ie),n.setUint16(8,xe,!0);let o=this.backend.emit(!1);for(let I of this.objectKeys.keys())this.writeString(I);let{strings:l,stringDefs:r,stringSlicesStart:f,stringSlicesEnd:s,stringRefs:i}=ve([...this.strings.keys()],this.stringRefs);this.backend.reset();let c=new TextEncoder,_=Array.from(l,I=>c.encode(I)),h=_.reduce((I,p)=>I+p.byteLength,0);this.writeVlq(h),_.forEach(I=>this.backend.writeBytes(I)),b(this,r),b(this,f),b(this,s),b(this,i),b(this,this.arrayLengths);let a=[...this.arrayHeaders.keys()];Ke(this.arrayHeaderRefs,a),b(this,a),b(this,this.arrayHeaderRefs),this.writeVlq(this.objectEntryDefs.length),this.writeVlq(this.objectKeys.size);for(let I of this.objectEntryDefs){let p=[0,...I.keys()],A=I.refs;Ke(A,p),b(this,p),b(this,A)}let x=this.backend.emit(!1);return pt([e,...x,...o])}writeString(e){let n=this.strings.get(e);n===void 0&&this.strings.set(e,n=this.strings.size),this.stringRefs.push(n)}writeObjectEntryKey(e,n,o){let l=this.objectKeys.get(n);l===void 0&&this.objectKeys.set(n,l=this.objectKeys.size);let r=e>=this.objectEntryDefs.length?this.objectEntryDefs[e]=Object.assign(new Map,{refs:[]}):this.objectEntryDefs[e],f=l<<8|o,s=this.objectEntryDefs[e].get(f);s===void 0&&r.set(f,s=r.size+1),r.refs.push(s)}writeObjectEntriesEnd(e){e>=this.objectEntryDefs.length?this.objectEntryDefs[e]=Object.assign(new Map,{refs:[0]}):this.objectEntryDefs[e].refs.push(0)}writeTypeIndex(e,n,o){let l=0,r=0,f=0;for(;n>0;)n&1&&(l|=f++<<(r<<2)),r++,n>>=1;let s=32-Math.clz32(f-1),i=0,c=0;for(let _=0;_<e.length;_++){let h=o?31-Math.clz32(e[_]||1):e[_],a=l>>(h<<2)&15;c|=a<<i,i+=s,i>=8&&(this.backend.writeUint8(c),i-=8,c>>=8)}i>0&&this.backend.writeUint8(c)}writeArrayLength(e){this.arrayLengths.push(e)}writeArrayHeader(e,n,o,l,r){let s=(l|(e&De)<<1|o<<5|r<<9)<<16|n,i=this.arrayHeaders.get(s);i===void 0&&this.arrayHeaders.set(s,i=this.arrayHeaders.size),this.arrayHeaderRefs.push(i)}vlqBytesNeeded(e){let n=0;for(;e>te;)e/=268435456,n+=4;return Qe[Math.clz32(e)]+n}writeVlq(e){if(e<=ye)this.backend.writeUint8(e<<1|0);else if(e<=Me)this.backend.writeUint16(e<<2|1);else if(e<=Oe)this.backend.writeUint24(e<<3|3);else{let n=e&te;this.backend.writeUint32((e>n?2147483648:0)+(n<<3|7)),e>n&&this.writeUintVar((e-n)/(1<<28))}}writeUintVar(e){if(e<=127)this.backend.writeUint8(e&127);else if(e<=16383)this.backend.writeUint16(e<<1&32512|128|e&127);else if(e<=2097151)this.backend.writeUint24(e<<2&8323072|32768|e<<1&32512|128|e&127);else{let n=this.vlqBytesNeeded(e);this.backend.ensureCapacity(n);for(let o=0;o<n-1;o++)this.backend.writeUint8(128|e&127),e=e>z?(e-(e&127))/128:e>>>7;this.backend.writeUint8(e&127)}}intVarBytesNeeded(e){return this.vlqBytesNeeded(e<0?-2*e:2*e)}writeIntVar(e){let n=0;if(e<0&&(n=1,e=-e),e<=Ae)e=e<<1|n;else if(e<=Tt)e=2*e+n;else{let o=(e&ee)<<1|n;this.backend.ensureCapacity(4),this.backend.writeUint32(2155905152|o&127|o<<1&32512|o<<2&8323072|o<<3&2130706432),e=Math.floor(e/(ee+1))}this.writeUintVar(e)}writeNumber(e,n){switch(n){case u:this.backend.writeUint8(e);break;case w:this.backend.writeUint16(e);break;case m:this.backend.writeUint24(e);break;case F:this.backend.writeUint32(e);break;case q:this.writeUintVar(e);break;case D:this.backend.writeInt8(e);break;case V:this.backend.writeInt16(e);break;case B:this.backend.writeInt24(e);break;case j:this.backend.writeInt32(e);break;case X:this.writeIntVar(e);break;case K:this.backend.writeFloat32(e);break;case Q:this.backend.writeFloat64(e);break;default:throw new Error("Unknown numeric type: "+n)}}};function Ne(t){return v(t)||G}function v(t){switch(typeof t){default:return L;case"boolean":return t?ne:re;case"string":return P;case"number":return Number.isFinite(t)?U:G;case"object":return t===null?G:Array.isArray(t)?S:d}}function He(t,e){let n=0;for(let o=0;o<t.length;o++)t[o]===e&&n++;return n}var We=new Map,Et=Object.freeze({hasInlinedEntries:!1,columns:We}),At=Object.freeze({hasInlinedEntries:!0,columns:We});function Je(t,e,n){if((n&d)===0)return Et;let o=n===d,l=o?t.length:He(e,d);if(l>1){let r=new Map,f=!1;for(let s=0,i=0;s<t.length;s++)if(o||e[s]===d){let c=t[s];for(let _ of Object.keys(c)){let h=c[_],a=v(h);if(a===L)continue;let x=r.get(_);x===void 0&&r.set(_,x={key:_,typeBitmap:0,values:new Array(l),valueCount:0}),x.typeBitmap|=a,x.values[i]=h,x.valueCount++}i++}for(let s of r.values()){s.valueCount!==l&&(s.typeBitmap|=Ce);let i=C[s.typeBitmap];if(i===1)continue;let c=32-Math.clz32(i-1),h=2+Math.ceil(c*l/8),a=s.valueCount*(1+!f);h>a&&(f=!0,r.delete(s.key))}if(r.size>0)return{hasInlinedEntries:f,columns:r}}return At}var ut=$e();function Ze(){ut=$e()}function $e(){return new Proxy(Object.create(null),{get(t,e){return Object.hasOwn(t,e)?Reflect.get(...arguments):t[e]=0}})}var bt=Object.hasOwnProperty,dt=new Map;function et(t){let e=v(t);return e===L?0:(e===U?_e(t):0)<<3|31-Math.clz32(e)}function tt(t,e={}){function n(s,i=dt){let c=0;for(let _ in s)if(bt.call(s,_)&&!i.has(_)){let h=s[_],a=et(h);if(a===L)continue;r.writeObjectEntryKey(c,_,a),l(a,h),c++}r.writeObjectEntriesEnd(c)}function o(s,i=!1,c=0){if(s.length===0){r.writeArrayLength(0);return}let _=null,h=0,a=null;if(c===0)for(let N=0;N<s.length;N++)c|=Ne(s[N]);C[c]>1&&(_=s.map(Ne)),c&U&&(a=c===U?s:s.filter((N,T)=>_[T]===U),h=ae(r,a,!1));let{hasInlinedEntries:x,columns:I}=Je(s,_,c),p=I.size!==0,A=0;if(i||r.writeArrayLength(s.length),r.writeArrayHeader(c,h,p,x,A),C[c]>1&&r.writeTypeIndex(_,c,!0),c&P)for(let N=0;N<s.length;N++)(_===null||_[N]===P)&&r.writeString(s[N]);if(c&U&&he(r,a,h),A){let N=c===S?s:s.filter(Array.isArray);b(r,N.map(T=>T.length),!0),o(N.flat())}else if(c&S)for(let N=0;N<s.length;N++)(_===null||_[N]===S)&&o(s[N]);if(p){r.writeVlq(I.size);for(let N of I.keys())r.writeString(N);for(let N of I.values())o(N.values,!0,N.typeBitmap)}if(x)for(let N=0;N<s.length;N++)(_===null||_[N]===d)&&n(s[N],I)}function l(s,i){switch(1<<(s&7)){case P:r.writeString(i);break;case U:r.writeNumber(i,s>>3);break;case d:n(i);break;case S:o(i);break}}let r=new Z(e.chunkSize),f=et(t);return Ze(),r.writeNumber(f,u),l(f,t),r.emit()}
